package com.example.cinema;

import org.springframework.web.bind.annotation.*;
import org.springframework.core.io.ClassPathResource;
import org.springframework.http.ResponseEntity;
import org.springframework.http.MediaType;
import java.util.*;
import com.example.cinema.model.Film;
import com.example.cinema.model.News;
import java.nio.file.Files;

/**
 * REST controller exposing in-memory data for films, releases, news and images.
 * CORS is enabled for frontend development.
 */
@RestController
@CrossOrigin(origins = "*")
@RequestMapping("/api")
public class ApiController {

    private List<Film> films = new ArrayList<>();
    private List<News> newsPool = new ArrayList<>();

 // Initialize in-memory data
    public ApiController() {
        films.add(new Film(1L,"The Godfather",1972,"USA","Francis Ford Coppola","drammatico","the_godfather_thumbnail.jpg","the_godfather_screenshot.jpg",
                "Anni Quaranta. Come è consuetudine, durante il rinfresco per festeggiare le nozze della figlia Conny con Carlo, il \"padrino\" don Vito Corleone promette assistenza e protezione a familiari e amici. Invia il figliastro Tom Hagen in California per convincere in ogni modo il produttore Jack Woltz a scritturare il cantante Johnny nel suo prossimo film. Woltz non acconsente. Tom allora lo costringe ad accettare con un \"avvertimento\": l'uccisione del suo cavallo di razza preferito. Sollozzo, a nome della potente \"famiglia\" Tartaglia, chiede a Corleone finanziamenti e appoggi per il traffico di droga. Il rifiuto scatena una lotta cruenta tra le due cosche: lo stesso don Vito viene ferito gravemente; il figlio minore Michael lo salva da un secondo attentato. Michael, poi, scavalcando l'irruento fratello Sonny e Tom, temporeggiatore, organizza un incontro con Sollozzo e con il corrotto capitano di polizia McCluskey uccidendoli entrambi.","1972-03-24"));
        films.add(new Film(2L,"Schindler's List",1993,"USA","Steven Spielberg","drammatico","schindler_thumbnail.jpg","schindler_screenshot.jpg",
                "Cracovia, 1939. L'industriale tedesco Oskar Schindler, bella presenza e temperamento avventuroso, manovrando i vertici nazisti tenta di rilevare un fabbrica per produrre pignatte e marmitte. Già reclusi nel ghetto di Podgorze, ed impossibilitati a commerciare, alcuni ebrei vengono convinti da Schindler a fornire il denaro per rilevare l'edificio: li ripagherà impiegandoli nella fabbrica, pagandoli con utensili da scambiare e sottraendoli al campo di lavoro comandato dal sadico criminale tedesco Amon Goeth. Dopo aver ricevuto la breve visita di Emilie, la moglie che subito torna in Moravia vista la vita di libertino impenitente del marito, Schindler, sempre più nelle grazie dell'alto comando nazista e di Goeth, costruisce un campo per i suoi operai, dove le milizie non possono entrare senza la sua autorizzazione. Infine, scatenatosi lo sterminio, decide di attivare, dando fondo a tutte le sue risorse finanziarie, una fabbrica di granate nella natia Brinnlitz. Con l'aiuto dell'inseparabile Itzhak Stern, il contabile ebreo, compila una lista di 1100 persone ebree perché vengano a lui affidate come operai. Mentre gli uomini arrivano a destinazione, le donne vengono per errore tradotte ad Auschwitz, e solo con grande rischio ed impiegando a fondo risorse e conoscenze, Schindler riesce a strapparle alla morte. Per sette mesi la fabbrica produce appositamente granate difettose, finché l'armistizio non trova l'industriale senza denaro. I suoi operai gli donano un anello d'oro con su incisa una frase del Talmud: \"Chiunque salva una vita salva il mondo intero\".","1993-12-15"));
        films.add(new Film(3L,"Atonement",2007,"UK","Joe Wright","drammatico","atonement_thumbnail.jpg","atonement_screenshot.jpg",
                "La giovane Bryoni Tallis a soli tredici anni ha già una forte passione per la scrittura e una vivida immaginazione. E questa passione la porterà a commettere un atto che rovinerà la vita di sua sorella Cecilia e del suo giovane innamorato Robbie Turner, figlio della governante, che verrà ingiustamente accusato di violenza sessuale. Nel corso della sua vita Bryoni cercherà di espiare la sua colpa scrivendo un romanzo per raccontare la verità sui fatti accaduti...","2007-09-07"));
        films.add(new Film(4L,"The Notebook",2004,"USA","Nick Cassavetes","sentimentale","notebook_thumbnail.jpg","notebook_screenshot.jpg",
                "In una casa di riposo, un uomo anziano sta leggendo a una donna, anche lei anziana, pagine sbiadite dal tempo di vecchi quaderni di appunti. Le sta narrando la storia di due giovani innamorati, Noah Calhoun e Allie Hamilton. Dopo una splendida estate passata insieme, Noah e Allie, provenienti da ceti sociali differenti, sono costretti a separarsi poiché i genitori di lei non approvano i loro sentimenti. Nel frattempo scoppia la Seconda Guerra Mondiale, Noah parte per il fronte e Allie, non ricevendo alcuna notizia dal suo innamorato, si fidanza con Lon, un giovane benestante che piace molto alla sua famiglia. Finita la guerra Noah torna a casa e decide di restaurare un'antica casa per accogliere Allie, se lei lo vorrà. La ragazza però, si trova a dover scegliere tra contraddire i desideri dei suoi genitori o seguire il suo cuore...","2004-06-25"));
        films.add(new Film(5L,"Blue Valentine",2010,"USA","Derek Cianfrance","sentimentale","blue_valentine_thumbnail.jpg","blue_valentine_screenshot.jpg",
                "Blue Valentine racconta la particolare storia d’amore di Dean (Ryan Gosling) e Cindy (Michelle Williams). Lui ha lasciato gli studi molto presto e ha deciso di fare il traslocatore per una compagnia di Brooklyn; lei, invece, studia per diventare medico e abita ancora a casa dei suoi genitori, occupandosi anche di sua nonna. È proprio nell’ospizio dove l’anziana è ricoverata in Pennsylvania che i due si conoscono. Tra loro nasce subito una forte attrazione che li porta a frequentarsi e a cominciare una relazione.\n"
                + "Qualche tempo dopo la ragazza confida a Dean di aspettare un bambino, ma di non essere sicura che il padre sia lui. Il figlio potrebbe essere del suo ex, Bobby (Mike Vogel), un tipo violento con il quale non era stata particolarmente attenta. Se in un primo momento Cindy decide di abortire, alla fine sceglie di portare avanti la gravidanza. Dean è talmente innamorato di lei che vuole sposarla comunque, anche se il bimbo che porta in grembo potrebbe non avere il suo stesso dna. Le cose si complicano quando Bobby scopre della loro relazione e, in un impeto di rabbia, picchia ferocemente Dean…","2010-12-31"));
        films.add(new Film(6L,"La La Land",2016,"USA","Damien Chazelle","sentimentale","lalaland_thumbnail.jpg","lalaland_screenshot.jpg",
                "L'intensa e burrascosa storia d'amore tra un'attrice e un musicista che si sono appena trasferiti a Los Angeles in cerca di fortuna. Mia è un'aspirante attrice che, tra un provino e l'altro, serve cappuccini alle star del cinema. Sebastian è un musicista jazz che sbarca il lunario suonando nei piano bar. Dopo alcuni incontri casuali, fra Mia e Sebastian esplode una travolgente passione nutrita dalla condivisione di aspirazioni comuni, da sogni intrecciati e da una complicità fatta di incoraggiamento e sostegno reciproco. Ma quando iniziano ad arrivare i primi successi, i due si dovranno confrontare con delle scelte che metteranno in discussione il loro rapporto. La minaccia più grande sarà rappresentata proprio dai sogni che condividono e dalle loro ambizioni professionali.","2016-12-09"));

     // 12 articoli realistici e completi
        newsPool.add(new News(
            1L,
            "Primo trailer di *Eclipse*: il thriller sci-fi che sta facendo impazzire il web",
            "news1_thumbnail.jpg",
            "Il primo trailer di Eclipse ha immediatamente catalizzato l’attenzione degli appassionati del genere. Atmosfere cupe, una fotografia ricercata e un ritmo serrato dominano i 120 secondi del filmato, anticipando un’opera che sembra voler unire tensione psicologica e fantascienza di alto livello.\n"
            + "\n"
            + "Il protagonista, interpretato da Noah Carter, si risveglia in una città sospesa tra passato e presente, dove gli edifici mutano forma e i suoni sembrano provenire da epoche differenti. A complicare la vicenda c’è la misteriosa figura di Aurora, una donna che sostiene di conoscere la verità dietro alle distorsioni temporali che affliggono il mondo.\n"
            + "\n"
            + "Secondo la regista Maya Henders, l’intero film esplora il fragile confine tra memoria e percezione: «Non volevo raccontare una storia lineare, ma immergere lo spettatore dentro una mente che vacilla». L’uso combinato di effetti pratici, set deformabili e VFX avanzati ha attirato grande curiosità sulla produzione, che molti indicano come possibile caso mediatico dell’anno.\n"
            + "\n"
            + "Critici e fan stanno già analizzando ogni fotogramma, alla ricerca di indizi sulla trama e sui simboli nascosti. Il film arriverà nelle sale a novembre, ma l’hype è già alle stelle."
        ));

        newsPool.add(new News(
            2L,
            "Il Festival di Venezia celebra le nuove voci del cinema indipendente",
            "news2_thumbnail.jpg",
            "L’edizione di quest’anno del Festival di Venezia ha dedicato una sezione speciale alle opere prime e ai giovani registi emergenti, attirando l’attenzione della critica internazionale. Molti film hanno affrontato temi complessi come l’identità, l’immigrazione, i rapporti familiari e le nuove tecnologie, offrendo punti di vista freschi e profondamente umani.\n"
            + "\n"
            + "Uno dei titoli più discussi è Luce Nascosta, dramma familiare diretto da Giulia Vanni. Il film racconta il ritorno improvviso di un padre dopo anni di assenza e il difficile tentativo di ricostruire un legame con la figlia adolescente. Nonostante il budget ridotto, la regista ha mostrato un controllo sorprendente sul linguaggio visivo, alternando primi piani intensi a silenzi sospesi che lasciano spazio all’immaginazione dello spettatore.\n"
            + "\n"
            + "Gli esperti parlano di una vera e propria rinascita del cinema indipendente europeo, favorita anche dalle nuove politiche di finanziamento e dalle piattaforme di streaming che cercano contenuti originali. La sezione è stata accolta con applausi calorosi e diversi film hanno già trovato distribuzione internazionale."
        ));

        newsPool.add(new News(
            3L,
            "Collaborazione inattesa: Sorrentino e Villeneuve lavorano a un progetto congiunto",
            "news3_thumbnail.jpg",
            "L’annuncio ha lasciato il mondo del cinema senza parole: Paolo Sorrentino e Denis Villeneuve stanno collaborando per la prima volta a un film drammatico ambientato nell’Europa del dopoguerra. Il progetto, ancora avvolto nel mistero, promette di unire lo stile visionario e poetico del regista italiano con la precisione narrativa e la monumentalità visiva del maestro canadese.\n"
            + "\n"
            + "Le prime indiscrezioni parlano della storia di due uomini sopravvissuti alla guerra che custodiscono un segreto capace di influenzare delicati equilibri politici. Le loro vite si intrecciano tra colpe, speranze e tentativi di rinascita in un continente dilaniato. La sceneggiatura, scritta a quattro mani, punta a un racconto emotivamente potente, dove i silenzi e gli sguardi hanno lo stesso peso dei dialoghi.\n"
            + "\n"
            + "Le riprese inizieranno nel 2025, tra Italia, Francia e Portogallo. Le case di produzione coinvolte hanno già confermato che verranno utilizzati set ricostruiti fedelmente e effetti speciali minimali per mantenere il realismo dell’epoca. L’attesa è altissima: molti parlano già di un “evento cinematografico irripetibile”."
        ));

        newsPool.add(new News(
            4L,
            "Netflix adatta il bestseller mondiale *La Città delle Nebbie*",
            "news4_thumbnail.jpg",
            "Netflix ha ufficializzato l’adattamento del romanzo La Città delle Nebbie, un fenomeno editoriale venduto in oltre 42 paesi. La serie sarà composta da otto episodi e unirà mistero, politica, dramma e soprannaturale in un unico grande mosaico narrativo.\n"
            + "\n"
            + "La storia segue la giovane investigatrice Lira Donovan mentre indaga su una serie di sparizioni misteriose in una città perennemente immersa nella nebbia. La presenza di una forza antica, in grado di distorcere la percezione umana, aggiunge un elemento inquietante che ha reso il libro un cult tra i lettori.\n"
            + "\n"
            + "Nel cast spiccano Emma Roberts e Louis Garrel, mentre la stessa autrice Claire Duvall ha partecipato alla scrittura della serie. Duvall ha dichiarato: «La cura per ogni dettaglio mi ha stupita. Alcune scelte visive amplificano il senso di inquietudine più del libro stesso».\n"
            + "\n"
            + "Le riprese inizieranno a breve in Irlanda, location ideale grazie ai paesaggi evocativi e avvolti dalla nebbia."
        ));

        newsPool.add(new News(
            5L,
            "Realtà virtuale e set digitali: così cambia il futuro degli effetti speciali",
            "news5_thumbnail.jpg",
            "La virtual production sta rivoluzionando radicalmente l’industria cinematografica. Con l’uso di enormi schermi LED e ambienti digitali generati in tempo reale, i registi possono immergere gli attori in set virtuali estremamente realistici, riducendo i tempi e i costi di produzione.\n"
            + "\n"
            + "Molti esperti parlano di una “terza rivoluzione visiva”, dopo l’avvento del digitale e l’esplosione del CGI. Le atmosfere possono essere modificate in pochi secondi, la luce può essere adattata senza dover ricorrere a riflettori fisici e i movimenti di camera vengono tracciati automaticamente dal motore grafico.\n"
            + "\n"
            + "Produzioni come The Mandalorian, Dune e diversi film Marvel hanno già dimostrato l’enorme potenziale di questa tecnologia. Secondo alcune stime, entro cinque anni sarà lo standard in oltre il 70% dei set di alto budget. Le scuole di cinema hanno già iniziato a inserirla nei loro programmi, preparando la prossima generazione di tecnici."
        ));

        newsPool.add(new News(
            6L,
            "Intervista esclusiva a Sofia Moretti: «Questo ruolo mi ha cambiata»",
            "news6_thumbnail.jpg",
            "Sofia Moretti, protagonista del film Oltre il Silenzio, ha raccontato quanto la preparazione per interpretare una ricercatrice affetta da un raro disturbo neurologico abbia trasformato profondamente la sua carriera e la sua sensibilità umana.\n"
            + "\n"
            + "L’attrice ha trascorso mesi a studiare casi clinici, incontrare neurologi e ascoltare testimonianze reali. «Volevo che il mio personaggio fosse autentico, rispettoso e lontano da qualsiasi stereotipo», ha dichiarato. Le riprese sono state emotivamente intense, soprattutto durante le scene che mostrano il progressivo deterioramento della memoria a breve termine della protagonista.\n"
            + "\n"
            + "Il regista Riccardo Balestri ha lodato la dedizione dell’attrice, definendola una delle performance più potenti della sua carriera. Il film è già stato selezionato per diversi festival internazionali e molti critici prevedono nomination importanti."
        ));

        newsPool.add(new News(
            7L,
            "L’intelligenza artificiale arriva sul set: tra opportunità e timori",
            "news7_thumbnail.jpg",
            "L’industria cinematografica sta vivendo una trasformazione senza precedenti grazie all’arrivo di sistemi di intelligenza artificiale in grado di generare storyboard, pre-visualizzazioni dinamiche e perfino montaggi preliminari.\n"
            + "\n"
            + "Le case di produzione vedono l’AI come uno strumento capace di velocizzare i flussi di lavoro, ridurre gli errori e aiutare a prendere decisioni creative. Tuttavia, non mancano le preoccupazioni: molti professionisti temono una progressiva sostituzione di ruoli creativi come concept artist, montatori e addetti alla scenografia.\n"
            + "\n"
            + "Le associazioni di categoria chiedono regole chiare per tutelare i lavoratori e preservare l’autorialità artistica. Alcuni studi indipendenti stanno sperimentando forme collaborative, dove l’intelligenza artificiale supporta, ma non sostituisce, i creativi. Il dibattito rimane aperto e particolarmente acceso."
        ));

        newsPool.add(new News(
            8L,
            "Retrospettiva dedicata a Hayao Miyazaki conquista la critica",
            "news8_thumbnail.jpg",
            "La nuova retrospettiva dedicata a Hayao Miyazaki ha attirato migliaia di visitatori e appassionati di animazione. L’esposizione ripercorre quasi cinquant’anni di carriera, presentando materiali rarissimi: schizzi, bozzetti, storyboard originali e interviste mai pubblicate prima.\n"
            + "\n"
            + "Il percorso espositivo permette di scoprire l’evoluzione del suo stile, dall’approccio più tradizionale dei primi anni fino alla complessità poetica dei capolavori dello Studio Ghibli. La mostra dedica particolare attenzione ai temi ricorrenti del regista: il rapporto tra uomo e natura, la crescita personale, la spiritualità e l’importanza della memoria.\n"
            + "\n"
            + "Critici e storici dell’animazione hanno elogiato la cura con cui è stata realizzata, definendola una delle migliori retrospettive mai dedicate al maestro giapponese. Il pubblico, spesso emozionato, racconta di aver riscoperto la profondità delle sue opere."
        ));

        newsPool.add(new News(
            9L,
            "Roma ospita la premiere europea di *Falling Skies*",
            "news9_thumbnail.jpg",
            "Roma ha accolto la premiere europea del nuovo film fantasy Falling Skies con un evento spettacolare sul red carpet. Fans provenienti da tutta Italia si sono radunati fuori dal teatro, creando un’atmosfera da grande produzione hollywoodiana.\n"
            + "\n"
            + "Il cast al completo ha salutato il pubblico, firmato autografi e raccontato curiosità sulla realizzazione del film. Il regista Alejandro Torres ha dichiarato: «Questo film è una lettera d’amore all’immaginazione e alla capacità umana di sognare mondi impossibili».\n"
            + "\n"
            + "Dopo la proiezione, la critica ha elogiato gli effetti speciali, le creature realizzate in CGI e la colonna sonora epica composta da Lena Shirosaki. Il film potrebbe diventare uno dei maggiori successi fantasy dell’anno grazie al mix di avventura, emozione e spettacolarità visiva."
        ));

        newsPool.add(new News(
            10L,
            "Colonna sonora di *Silent Horizon* candidata a tre premi internazionali",
            "news10_thumbnail.jpg",
            "La colonna sonora di Silent Horizon, composta da Haru Matsuda, ha ottenuto tre prestigiose nomination, tra cui quella per Miglior Colonna Sonora Originale ai World Film Awards. La critica ha lodato la capacità del compositore di fondere strumenti elettronici e melodie orchestrali, creando un sound sospeso e ipnotico.\n"
            + "\n"
            + "Matsuda ha raccontato di aver registrato parte dei suoni in località remote, utilizzando echi naturali e rumori d’ambiente per dare al film un’identità unica. La musica è diventata un elemento centrale della narrazione, accompagnando il protagonista in un viaggio introspettivo tra sogni e realtà.\n"
            + "\n"
            + "Il film sta ottenendo risultati eccellenti al botteghino internazionale e molti prevedono che la colonna sonora entrerà tra le più iconiche degli ultimi anni."
        ));

        newsPool.add(new News(
            11L,
            "Documentario *Senza Confini* emoziona pubblico e critica",
            "news11_thumbnail.jpg",
            "Il documentario Senza Confini narra la storia di tre volontari impegnati nelle zone più fragili del mondo, mostrando la loro quotidianità fatta di sacrifici, rischi e piccoli momenti di umanità. Il regista ha scelto un approccio intimo, seguendo i protagonisti senza filtri, lasciando che siano i loro gesti e le loro parole a parlare.\n"
            + "\n"
            + "La proiezione al Torino Film Festival ha commosso la sala: molti spettatori si sono alzati in piedi per applaudire la forza e la vulnerabilità dei protagonisti. La critica ha lodato la fotografia evocativa, che riesce a catturare la bellezza dei luoghi nonostante le difficoltà sociali e ambientali.\n"
            + "\n"
            + "Gli analisti considerano il documentario uno dei favoriti della stagione, capace di sensibilizzare il pubblico senza ricorrere a sensazionalismi, ma mostrando la realtà in tutta la sua complessità."
        ));

        newsPool.add(new News(
            12L,
            "Nuove sale immersive IMAX aprono in tutta Italia",
            "news12_thumbnail.jpg",
            "Il settore cinematografico italiano sta vivendo una forte ripresa e, in questo contesto, diverse città inaugureranno nuove sale IMAX dotate di schermi a curvatura dinamica e sistemi audio 12.1 di ultima generazione.\n"
            + "\n"
            + "L’obiettivo è riportare gli spettatori nelle sale offrendo un’esperienza impossibile da replicare a casa: immagini gigantesche, colori più profondi, bassi che fanno vibrare le poltrone e una nitidezza che esalta ogni dettaglio. Le sale saranno utilizzate per film d’azione, fantascienza, documentari naturalistici e produzioni sperimentali.\n"
            + "\n"
            + "I gestori dei cinema sperano che questa nuova ondata tecnologica possa attirare un pubblico più giovane, abituato a contenuti veloci ma sempre più curioso di vivere esperienze immersive e spettacolari. Le prime inaugurazioni sono previste entro fine anno."
        ));

    }


    // -----------------------------
    //           ENDPOINTS
    // -----------------------------

    // Return films grouped by genre
    @GetMapping("/genres")
    public Map<String, List<Film>> getByGenre() {
        Map<String, List<Film>> map = new HashMap<>();
        map.put("drammatico", new ArrayList<>());
        map.put("sentimentale", new ArrayList<>());
        for(Film f: films){
            if("drammatico".equalsIgnoreCase(f.genre)) map.get("drammatico").add(f);
            if("sentimentale".equalsIgnoreCase(f.genre)) map.get("sentimentale").add(f);
        }
        return map;
    }

    // Return film by ID
    @GetMapping("/films/{id}")
    public Film getFilm(@PathVariable Long id){
        return films.stream().filter(f -> f.id.equals(id)).findFirst().orElse(null);
    }

    // Releases grouped by relative weeks
    @GetMapping("/releases")
    public Map<String, List<Film>> getReleases(){
        Map<String, List<Film>> r = new HashMap<>();
        r.put("previous", Arrays.asList(films.get(0), films.get(1)));
        r.put("this", Arrays.asList(films.get(2), films.get(3)));
        r.put("week1", Arrays.asList(films.get(4), films.get(5)));
        r.put("week2", Arrays.asList(films.get(1), films.get(4)));
        r.put("week3", Arrays.asList(films.get(0), films.get(5)));
        return r;
    }

    // Return 3 random news from pool
    @GetMapping("/news")
    public List<News> getRandomNews(){
        Collections.shuffle(newsPool);
        return newsPool.subList(0,3);
    }

    // -----------------------------
    //        *** MANCAVA ***
    //   Return single news by ID
    // -----------------------------
    @GetMapping("/news/{id}")
    public News getNewsById(@PathVariable Long id){
        return newsPool.stream()
                .filter(n -> n.id.equals(id))
                .findFirst()
                .orElse(null);
    }

    // Serve images from classpath resources/static/images
//    @GetMapping(value = "/images/{name}")
//    public ResponseEntity<byte[]> getImage(@PathVariable String name) throws Exception {
//        ClassPathResource imgFile = new ClassPathResource("static/images/" + name);
//        if(!imgFile.exists()) return ResponseEntity.notFound().build();
//        byte[] bytes = Files.readAllBytes(imgFile.getFile().toPath());
//        return ResponseEntity.ok().contentType(MediaType.IMAGE_JPEG).body(bytes);
//    }
}
